  <script>
    window.onAmazonLoginReady = function() {
      amazon.Login.setClientId('amzn1.application-oa2-client.6a339767de8e43488a78fd93592e3f27');
    };

    window.getParameterByName = function(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    window.onAmazonPaymentsReady = function(){
      new OffAmazonPayments.Widgets.AddressBook({
        sellerId: 'A3QCQLYZKBHFRS',
        onOrderReferenceCreate: function(orderReference) {
          // Here is where you can grab the Order Reference ID.
          console.log("onOrderReferenceCreate");
          var orderReferenceId = orderReference.getAmazonOrderReferenceId();
          var access_token = window.getParameterByName("access_token", window.location.href);

          window.orderReferenceId = orderReferenceId;
          window.access_token = access_token;
          console.log(orderReferenceId);
        },
        onAddressSelect: function(orderReference) {
          console.log("onAddressSelect");
          console.log("orderReference.getID()");
          console.log(orderReference.getID());
          // Replace the following code with the action that you want
          // to perform after the address is selected. The
          // amazonOrderReferenceId can be used to retrieve the address
          // details by calling the GetOrderReferenceDetails operation.

          // If rendering the AddressBook and Wallet widgets
          // on the same page, you do not have to provide any additional
          // logic to load the Wallet widget after the AddressBook widget.

          // The Wallet widget will re-render itself on all subsequent
          // onAddressSelect events without any action from you.
          // It is not recommended that you explicitly refresh it.
        },
        design: {
          designMode: 'responsive'
        },
        onReady: function(orderReference) {
          console.log("onReady");
          console.log(orderReference);
          // Enter code here that you want to be executed
          // when the address widget has been rendered.
        },

        onError: function(error) {
          console.log("error");
          console.log(error.getErrorCode() + ': ' + error.getErrorMessage());
          // Your error handling code.
          // During development you can use the following
          // code to view error messages:
          // console.log(error.getErrorCode() + ': ' + error.getErrorMessage());
          // See "Handling Errors" for more information.
        }
      }).bind("addressBookWidgetDiv");

      new OffAmazonPayments.Widgets.Wallet({
        sellerId: 'A3QCQLYZKBHFRS',
        onPaymentSelect: function(orderReference) {
          console.log("onPaymentSelect");
          console.log("orderReference.getID()");
          console.log(orderReference.getID());
          // Replace this code with the action that you want to perform
          // after the payment method is chosen.

          // Ideally this would enable the next action for the buyer
          // including either a "Continue" or "Place Order" button.
        },
        design: {
          designMode: 'responsive'
        },

        onError: function(error) {
          console.log("error");
          console.log(error.getErrorCode() + ': ' + error.getErrorMessage());
          // Your error handling code.
          // During development you can use the following
          // code to view error messages:
          // console.log(error.getErrorCode() + ': ' + error.getErrorMessage());
          // See "Handling Errors" for more information.
        }
      }).bind("walletWidgetDiv");
    }
  </script>

  <script async='async' type='text/javascript' src='https://static-fe.payments-amazon.com/OffAmazonPayments/jp/sandbox/lpa/js/Widgets.js'></script>

  <button onclick="return window.onClickPay()">Click to Pay</button>
  <br />
  <br />
  <br />
  <div id="addressBookWidgetDiv" style="width: 400px; height: 400px"></div>
  <br />
  <div id="walletWidgetDiv" style="width: 400px; height: 400px">
  <br />

</div>

<script>
  window.onClickPay = function() {
    var url = "http://localhost:3333/users/1/edit?access_token=" + window.access_token + "&order_reference_id=" + window.orderReferenceId;
    window.location.href = url;
  }
</script>
